// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.17/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/FeatureTable/templates/FeatureTable.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esri-feature-table-border-container" data-dojo-attach-point\x3d "_gridBorderContainer" data-dojo-type\x3d"dijit.layout.BorderContainer" gutters\x3d"false"\x3e\r\n    \x3cdiv class\x3d"esri-feature-table-content-pane esri-feature-table-menu" data-dojo-attach-point\x3d "_gridHeaderNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'top\'"\x3e\r\n      \x3cdiv class\x3d"esri-feature-table-menu-item esri-feature-table-loading-indicator" data-dojo-attach-point\x3d "_gridLoadingIndicatorNode" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"esri-feature-table-menu-item esri-feature-table-title" data-dojo-attach-point\x3d "_gridTitleNode"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"esri-feature-table-menu-item esri-feature-table-closer-container"\x3e\x3c/div\x3e   \r\n      \x3cdiv data-dojo-attach-point\x3d "_menuNode" class\x3d"esri-feature-table-menu-item esri-feature-table-menu-options"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d "_gridMenuNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esri-feature-table-content-pane" data-dojo-attach-point\x3d "_gridContentPane" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'center\'"\x3e\r\n      \x3cdiv class\x3d"esri-feature-table-grid" data-dojo-attach-point\x3d"_gridNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/FeatureTable","dojo/aspect dojo/on dojo/Deferred dojo/DeferredList dojo/promise/all dojo/Evented dojo/has dojo/date/locale dojo/query dojo/io-query dojo/number dojo/string dojo/dom-construct dojo/dom-class dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/text!../dijit/FeatureTable/templates/FeatureTable.html dojo/i18n!../nls/jsapi dojo/store/Cache dojo/store/Memory dojo/store/Observable dojo/store/util/QueryResults dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/a11yclick dijit/Dialog dijit/Menu dijit/MenuItem dijit/Tooltip dijit/focus dijit/form/DropDownButton dijit/form/TimeTextBox dijit/form/DateTextBox dijit/form/NumberTextBox dijit/form/Button dijit/form/Select dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/editor dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer ../kernel ../lang ../config ../request ../numberUtils ../geometry/Extent ../layers/FeatureLayer ../tasks/query ../tasks/StatisticDefinition ../tasks/QueryTask ../tasks/RelationshipQuery ../dijit/FeatureLayerQueryStore dijit/layout/BorderContainer dijit/layout/TabContainer dijit/layout/ContentPane dojo/query!css2 dojo/domReady!".split(" "),
function(y,m,B,C,z,R,K,S,xa,T,u,p,l,ya,D,L,d,k,U,E,V,M,W,X,Y,Z,$,aa,ba,ca,N,A,da,ea,fa,ga,O,F,G,H,ha,ia,ja,ka,I,la,ma,na,oa,pa,v,J,qa,ra,P,sa,t,ta,ua,va,w,za,wa,Q){C=L([Y,Z,$,aa,R],{baseClass:"esri-feature-table",loaded:!1,templateString:U,i18n:E,dataStore:null,columns:null,featureCount:0,idProperty:"id",grid:null,gridMenu:null,gridMenuAnchor:null,css:{featureTableColumnHeader:"esri-feature-table-column-header",featureTableColumnHeaderTitle:"esri-feature-table-column-header-title",featureTableColumnHeaderType:"esri-feature-table-column-header-type",
featureTableColumnHeaderClear:"esri-feature-table-column-header-clear",headerGear:"esri-feature-table-gear",settingsIcon:"esri-icon-settings",lockedIcon:"esri-icon-locked",optionsMenu:"esri-feature-table-options-menu-container",menuItem:"esri-feature-table-menu-item",dialog:"esri-feature-table-dialog",embeddedTitle:"esri-embedded-grid-title",relatedRecordsCell:"esri-feature-table-related-records-cell",relatedRecordsTitle:"esri-feature-table-related-records-title",relatedRecordsLink:"esri-related-records-link",
attachmentsCell:"esri-feature-table-attachments-cell",attachmentsTitle:"esri-feature-table-attachments-title",attachmentsLink:"esri-attachments-link",attachmentsContainer:"esri-attachments-container",attachmentsTabContainer:"esri-attachments-tab-container",attachmentsIcon:"esri-attachments-icon",attachmentsSize:"esri-attachments-size",attachmentsNode:"esri-attachments-node",attachmentsNodeIcon:"esri-attachments-node-icon",attachmentsNodeIconArchive:"esri-attachments-node-icon-archive",attachmentsNodeIconAudioVideo:"esri-attachments-node-icon-audiovideo",
attachmentsNodeIconDocument:"esri-attachments-node-icon-document",attachmentsNodeIconImage:"esri-attachments-node-icon-image",attachmentsNodeIconOther:"esri-attachments-node-icon-other",attachmentsNodeTextContainer:"esri-attachments-node-text-container",attachmentsNodeTextName:"esri-attachments-node-text-name",attachmentsNodeTextSize:"esri-attachments-node-text-size",attachmentsNodeDelete:"esri-attachments-node-delete",attachementsViewPane:"esri-attachments-view-pane",attachementsViewPaneContent:"esri-attachments-view-pane-content",
attachementsAddPane:"esri-attachments-add-pane",attachementsAddPaneContent:"esri-attachments-add-pane-content",attachmentsFeedbackText:"esri-attachments-feedback-text"},featureLayer:null,map:null,layerInfo:null,fieldInfos:null,gridOptions:null,dateOptions:null,selectedRows:null,selectedRowIds:null,hiddenFields:null,outFields:null,editable:!1,syncSelection:!0,zoomToSelection:!0,showDataTypes:!1,showGridHeader:!0,showGridMenu:!0,showFeatureCount:!0,showColumnHeaderTooltips:!1,showRelatedRecords:!1,
showAttachments:!1,showStatistics:!0,menuFunctions:null,batchCount:50,showFieldDetails:!1,visibleLayerIds:null,showCyclicalRelationships:!1,filterIds:null,editOn:null,_defaultDateOptions:{timeEnabled:!1,timePattern:null,datePattern:null},_defaultGridOptions:{allowSelectAll:!1,cellNavigation:!0,selectionMode:"extended",pagination:!1,allowTextSelection:!1,pageSizeOptions:[10,25,50],columnHider:!0,columnResizer:!0,pagingDelay:300},_defaultSortField:null,_defaultEditOn:"dblclick, keypress",_queryStore:null,
_memoryStore:null,_featureSet:null,_orderByFields:null,_supportRelatedRecords:!1,_supportAttachments:!1,_editorTrackingInfos:null,_userIds:null,_featureSelectedCount:0,_filteredRowIds:null,_gridQuery:!1,_activeEditors:null,_rollbackInfos:null,_defaultBatchCount:2E3,_defaultFeatureCount:2E3,_expandedNodes:null,_nestedGrids:null,_i18nStrings:E.widgets.FeatureTable,_numericFieldTypes:["esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeSmallInteger"],_unsupportedFieldTypes:["esriFieldTypeGUID",
"esriFieldTypeRaster","esriFieldTypeBlob","esriFieldTypeGeometry","esriFieldTypeXML"],_attachmentInfos:null,_relatedRecordInfos:null,_supportedAttachmentTypes:["zip 7z gz gtar tar tgz".split(" "),"wmf wps avi mpg mpe mpeg mov wmv aif mid rmi mp2 mp3 mp4 mpa mpv2 qt ra ram wav wma".split(" "),"doc docx dot xls xlsx xlt pdf ppt pptx txt".split(" "),"bmp ecw emf eps ps gif img jp2 jpc j2k jpf jpg jpeg jpe png psd raw sid tif tiff".split(" "),"vrml gml json xml mdb gdb geodatabase".split(" ")],_statisticsDialog:null,
_numRelationshipColumns:5,constructor:function(a,b){},postMixInProperties:function(){this.inherited(arguments);this.set({columns:[],layerInfo:{idArray:[],fieldInfos:[]},selectedRows:[],selectedRowIds:[],_editorTrackingInfos:{},_userIds:{},_filteredRowIds:[],_activeEditors:[],_rollbackInfos:[],_expandedNodes:[],_nestedGrids:[],_attachmentInfos:{},_relatedRecordInfos:{},hiddenFields:this.hiddenFields||[],outFields:this.outFields||["*"],fieldInfos:this.fieldInfos||[],menuFunctions:this.menuFunctions||
[],gridOptions:d.mixin({},this._defaultGridOptions,this.gridOptions),dateOptions:d.mixin({},this._defaultDateOptions,this.dateOptions)});this._GridDefinition=this._generateGridDefinition();this._noDataMessage=this.gridOptions.noDataMessage||this._i18nStrings.noData;K("touch")&&!this.editOn?this.set("editOn",ba):this.editOn||this.set("editOn",this._defaultEditOn)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var a=this.get("featureLayer");a&&a.loadError?
this._showLoadError():this.domNode&&a.loaded?this._init():this.own(m(a,"load",d.hitch(this,function(){this._init()})),m(a,"error",d.hitch(this,function(){this._showLoadError()})))},refresh:function(){this.grid.refresh()},destroy:function(){this.inherited(arguments);this.gridMenu&&this.gridMenu.destroy();this._statisticsDialog&&this._statisticsDialog.destroy();this.columnMenu&&this.columnMenu.destroyRecursive();this.grid&&this.grid._destroyColumns();delete this.columns;delete this.layerInfo},resize:function(){this._resize()},
selectRows:function(a,b){var c=[],e=[],g,f,h;this._closeEditors();this.grid.clearSelection();a[0]&&"esri.Graphic"===a[0].declaredClass&&(a=c=k.map(a,function(a){return a.attributes[this.idProperty]},this));1===a.length?(g=a[0],c=this.dataStore.get(a),h=k.indexOf(this.dataStore.data,c),this.grid.select(g),this._updateGridSelection().then(d.hitch(this,function(){this._updateGridHeaderText();b&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*h}),(f=this.grid.row(g))&&f.element&&f.element.scrollIntoView())}))):
(k.forEach(a,function(a){e.push(a)},this),this.grid.select(e),this._updateGridSelection().then(d.hitch(this,function(){this._updateGridHeaderText()})))},filterSelectedRecords:function(a){a?this._showSelectedRecords():(this.grid.set("query",{}),this.set("_gridQuery",!1))},clearSelection:function(){this._clearSelection()},getRowDataById:function(a){return this.grid.row(a).data},getFeatureDataById:function(a){var b=new t;b.objectIds=[a];b.outFields=["*"];return this.featureLayer.queryFeatures(b,d.hitch(this,
function(a){return a.features[0]}))},_init:function(){this.set("idProperty",this.featureLayer.objectIdField);this._getLayerInfo().then(d.hitch(this,function(){this._getEditingInfo();var a=this.gridOptions.sort&&this._findFirst(this.featureLayer.fields,"name",this.gridOptions.sort);this._defaultSortField=a?a.name:this.idProperty;this.grid=this._generateGrid();this.grid.startup();this.grid.resize();this.grid.set("noDataMessage","");this._gridTitleNode.innerHTML=this._i18nStrings.loadingData;this._toggleLoadingIndicator(!0);
this.showGridMenu&&this._generateTableMenu();this.showGridHeader||D.set(this._gridHeaderNode.domNode,"display","none");this.own(this._addGridSelectListener(),this._addGridDeselectListener(),this._addGridDataChangeListener(),this._addGridRefreshListener(),this._addGridColumnStateChangeListener(),this._addGridColumnResizeListener(),this._addGridErrorListener(),this._addGridSortListener(),this._addGridFilterListener(),this._addGridEditorShowListener(),this._addGridEditorHideListener(),this._addGridColumnClickCallback(),
this._addGridLayerClickCallback(),this._addGridApplyEditsListener());this._resize();this.featureLayer.relationships&&(0<this.featureLayer.relationships.length&&this.get("showRelatedRecords"))&&(this._supportRelatedRecords=!0);this.featureLayer.hasAttachments&&this.get("showAttachments")&&(this._supportAttachments=!0);var b=this.watch("dataStore",d.hitch(this,function(a,e,g){null===e&&g&&(this.set("loaded",!0),this.emit("load",this.loaded),b.remove())}));this._generateStore()}))},_generateGridDefinition:function(){var a=
[ma,ha,ia,I,ja,ka];this.gridOptions.pagination&&a.push(la);this.gridOptions.columnHider&&a.push(na);this.gridOptions.columnResizer&&a.push(oa);return L(a)},_generateGrid:function(){var a=this.get("gridOptions"),b=this.get("columns"),c=this._GridDefinition,e=v.isDefined(this.featureLayer.maxRecordCount)?this.featureLayer.maxRecordCount:this._defaultBatchCount,e=Math.min(e,this.batchCount),g=new c({columns:b,sort:this._defaultSortField,noDataMessage:"",selectionMode:a.selectionMode,allowSelectAll:a.allowSelectAll,
allowTextSelection:a.allowTextSelection,cellNavigation:a.cellNavigation,keepScrollPosition:!0,pageSizeOptions:a.pageSizeOptions,minRowsPerPage:e,maxRowsPerPage:e,queryRowsOverlap:0,pagingDelay:a.pagingDelay,query:d.hitch(this,function(a){return!this.filterIds||-1!==this.filterIds.indexOf(a[this.idProperty])})},this._gridNode);y.before(g,"removeRow",d.hitch(this,function(a){k.forEach(b.length,function(c,b){var e=g.cell(a,b).element;(e=(e.contents||e).widget)&&e.destroyRecursive()},this)}));y.after(g,
"renderHeader",d.hitch(this,function(){g._sortListener.remove()}));return g},_generateStore:function(){var a=this.get("featureLayer"),b=this.get("grid");this.get("dataStore")&&(this.layerInfo.fieldInfos=[],this._emptyStore());this._getFeatureCount().then(d.hitch(this,function(c){this.set("featureCount",c);this.layerInfo&&(this.layerInfo.isFeatureCollection?(b.set("noDataMessage",this._noDataMessage),this._updateFieldInfos(this.featureLayer.fields),this._generateColumnsFromFieldInfos(),b.set("columns",
this.get("columns")),this._updateGridHeaderText(),this.layerInfo.features=this.featureLayer.graphics,this.set("dataStore",this._generateMemoryStore(this.featureLayer.graphics)),b.set("store",this.dataStore),this._toggleLoadingIndicator(!1)):this.featureCount>a.maxRecordCount?(this._updateFieldInfos(a.fields),this._generateColumnsFromFieldInfos(),b.set("columns",this.get("columns")),this._updateGridHeaderText(),a.advancedQueryCapabilities&&!a.advancedQueryCapabilities.supportsPagination?(c=this.filterIds||
this.layerInfo.idArray||null)&&c.length?(this.set("dataStore",this._generateCacheStore(c)),b.set("store",this.dataStore)):this._getAllIds().then(d.hitch(this,function(a){this.layerInfo.idArray=a;this.set("dataStore",this._generateCacheStore(a));b.set("store",this.dataStore)})).otherwise(d.hitch(this,function(){this._showLoadError()})):(this.set("dataStore",this._generateCacheStore(this.filterIds)),b.set("store",this.dataStore))):this._queryFeatureLayer().then(d.hitch(this,function(c){this._updateFieldInfos(c.fields||
a.fields);this._generateColumnsFromFieldInfos();b.set("columns",this.get("columns"));this._updateGridHeaderText();this._supportAttachments&&this._supportRelatedRecords?z([this._getAllIds(),this._getAttachments()]).then(d.hitch(this,function(g){var f;f=k.map(a.relationships,function(a){return this._queryRelatedRecords(g[0],a)},this);return z(f).then(d.hitch(this,function(){this.set("dataStore",this._generateMemoryStore(c.features));b.set("store",this.dataStore)}))})).otherwise(d.hitch(this,function(){this.set("dataStore",
this._generateMemoryStore(c.features));b.set("store",this.dataStore)})):this._supportAttachments?this._getAttachments().then(d.hitch(this,function(){this.set("dataStore",this._generateMemoryStore(c.features));b.set("store",this.dataStore)})).otherwise(d.hitch(this,function(){this.set("dataStore",this._generateMemoryStore(c.features));b.set("store",this.dataStore)})):this._supportRelatedRecords?this._getAllIds().then(d.hitch(this,function(g){var f=[];k.forEach(a.relationships,function(a){f.push(this._queryRelatedRecords(g,
a))},this);z(f).then(d.hitch(this,function(a){this.set("dataStore",this._generateMemoryStore(c.features));b.set("store",this.dataStore)})).otherwise(d.hitch(this,function(){this.set("dataStore",this._generateMemoryStore(c.features));b.set("store",this.dataStore)}))})).otherwise(d.hitch(this,function(){this.emit("error",{message:this._i18nStrings.errorGenerateStore});this._showLoadError()})):(this.set("dataStore",this._generateMemoryStore(c.features)),b.set("store",this.dataStore))})).otherwise(d.hitch(this,
function(a){this._showLoadError();b.set("noDataMessage",this._noDataMessage)})))})).otherwise(d.hitch(this,function(){this.emit("error",{message:this._i18nStrings.errorFeatureInfo});this._showLoadError()}))},_emptyStore:function(){this._toggleLoadingIndicator(!0);this._gridTitleNode.innerHTML=this._i18nStrings.loadingData;this.grid.set({store:null,noDataMessage:""});this.set("dataStore",null)},_queryFeatureLayer:function(a){var b=new t;b.where="1\x3d1";b.returnGeometry=!1;b.objectIds=a;return this.featureLayer.queryFeatures(b)},
_getFeatureCount:function(){var a=new t;a.returnGeometry=!1;a.returnCountOnly=!0;a.where="1\x3d1";J.defaults.io.timeout=1E4;return this.featureLayer.queryCount(a).then(d.hitch(this,function(a){J.defaults.io.timeout=6E4;return a}),d.hitch(this,function(){J.defaults.io.timeout=6E4;return this.layerInfo.isFeatureCollection?this.featureLayer.graphics.length:this._defaultFeatureCount}))},_getAllIds:function(){var a=new t;a.returnGeometry=!1;a.outFields=[this.idProperty];a.where="1\x3d1";a.returnIdsOnly=
!0;return this.featureLayer.queryIds(a)},_queryAttachmentInfos:function(a){return this.featureLayer.queryAttachmentInfos(a||0)},_getAttachments:function(a){var b=new B;this._queryAttachments(a).then(d.hitch(this,function(a){a=a.attachmentGroups;a||(this.layerInfo.queryAttachmentsSupported=!1);k.forEach(a,function(a){this._attachmentInfos[a.parentObjectId]={attachments:a.attachmentInfos}},this);b.resolve(this._attachmentInfos)})).otherwise(d.hitch(this,function(a){this.layerInfo.queryAttachmentsSupported=
!1;b.reject(a)}));return b},_queryAttachments:function(a){return qa({url:this.featureLayer._url.path+"/queryAttachments",content:{f:"json",objectIds:a},handleAs:"json",callbackParamName:"callback"})},_queryRelatedRecords:function(a,b){var c=new va;c.outFields=["*"];c.returnGeometry=!1;c.relationshipId=b.id;c.objectIds=a;return this.featureLayer.queryRelatedFeatures(c).then(d.hitch(this,function(a){return this._relatedRecordInfos[b.id]=a}))},_getRelatedRecordsByIds:function(a,b){return this._relatedRecordInfos[b]?
this._relatedRecordInfos[b][a]:[]},_generateCacheStore:function(a){var b,c;a=new w({layer:this.featureLayer,objectIds:a,totalCount:a&&a.length?a.length:this.featureCount,batchCount:this.batchCount,where:"1\x3d1",orderByFields:this._orderByFields&&this._orderByFields.length?this._orderByFields:[this._defaultSortField+" ASC"],getAttachments:this._supportAttachments,getRelatedRecords:this._supportRelatedRecords});b=new M;c=new V(a,b,{});this.set({_queryStore:a,_memoryStore:b});this.grid.set("noDataMessage",
this._noDataMessage);y.before(c,"query",d.hitch(this,function(a,c){this._toggleLoadingIndicator(!0)}));y.after(c,"query",d.hitch(this,function(a){a.then(d.hitch(this,function(a){a.attachmentInfos?this._attachmentInfos=d.mixin(this._attachmentInfos,a.attachmentInfos):a.attachmentInfos||(this.layerInfo.queryAttachmentsSupported=!1);a.relatedRecordInfos&&(this._relatedRecordInfos=this._mergeRelatedRecordInfos(this._relatedRecordInfos,a.relatedRecordInfos));this._toggleLoadingIndicator(!1)}));return a}));
return c},_mergeRelatedRecordInfos:function(a,b){if(null===a||null===b)return a;for(var c in b){a[c]||(a[c]={});for(var e in b[c])a[c][e]=b[c][e]}return a},_generateMemoryStore:function(a){var b=[];k.forEach(a,function(a){b.push(a.attributes)},this);a=new W(new M({data:b,idProperty:this.get("idProperty")}));a.query=d.hitch(this,this._generateStoreSort);this.grid.set("noDataMessage",this._noDataMessage);this._toggleLoadingIndicator(!1);return a},_generateStoreSort:function(a,b){var c=d.hitch(this,
function(){return d.hitch(this,function(a,c){var b=e[0],d=b.columnId,n;("ft_attachments"===b.attribute||"ft_related-records"===b.fieldType)&&"undefined"!==typeof d?(d=parseInt(d,10),n=this.grid.columns[d].get(a),d=this.grid.columns[d].get(c)):(n=a[b.attribute]&&a[b.attribute].toLowerCase?a[b.attribute].toLowerCase():a[b.attribute],d=c[b.attribute]&&c[b.attribute].toLowerCase?c[b.attribute].toLowerCase():c[b.attribute]);n=null!==n?n.valueOf():n;d=null!==d?d.valueOf():d;return null===n&&null!==d?b.descending?
-1:1:null!==n&&null===d?b.descending?1:-1:n===d?0:(n>d?1:-1)*(b.descending?-1:1)})}),e=b&&b.sort;e&&"function"!==typeof e&&(b.sort=c());return new X(this.dataStore.queryEngine(a,b)(this.dataStore.data))},_getLayerInfo:function(){var a=new B,b={},c=this.featureLayer,e=c.id||c.layerId;c.credential&&(this._userIds[e]=this.featureLayer.credential.userId);b.userId&&(this._userIds[e]=b.userId);b.isFeatureCollection=c._collection&&!0===c._collection||null===c.url&&null===c._url?!0:!1;b.idProperty=this.get("idProperty");
b.layerId=e;b.fieldInfos=[];b.hasAttachments=c.hasAttachments;b.typeIdField=c.typeIdField;b.types=c.types;b.editCapabilities={};b.editable=c.isEditable();b.queryAttachmentsSupported=!0;this.set("layerInfo",d.clone(b));a.resolve(this.layerInfo);return a},_getEditingInfo:function(){var a=[];this.featureLayer.getEditCapabilities&&(this.layerInfo.editCapabilities=this.featureLayer.getEditCapabilities());this.featureLayer.editFieldsInfo&&(this.featureLayer.editFieldsInfo.creatorField&&a.push(this.featureLayer.editFieldsInfo.creatorField),
this.featureLayer.editFieldsInfo.creationDateField&&a.push(this.featureLayer.editFieldsInfo.creationDateField),this.featureLayer.editFieldsInfo.editorField&&a.push(this.featureLayer.editFieldsInfo.editorField),this.featureLayer.editFieldsInfo.editDateField&&a.push(this.featureLayer.editFieldsInfo.editDateField));this._editorTrackingInfos[this.featureLayer.id]=a},_updateFieldInfos:function(a){if(a&&!(0===a.length||null===this.layerInfo))a=this._generateColumnOrder(a),k.forEach(a,function(a,c){var e,
g,f,h,x=!1,n=this._findFirst(this.featureLayer.fields,"name",a.name)||{},q=this._findFirst(this.fieldInfos,"name",a.name)||this._findFirst(this.fieldInfos,"fieldName",a.name);e=q&&(q.label||q.alias)||n.alias;f=n.domain||!1;g=this.layerInfo.typeIdField&&a.name===this.layerInfo.typeIdField||!1;this.layerInfo&&this.layerInfo.types&&k.forEach(this.layerInfo.types,function(c){c.domains&&c.domains[a.name]&&(x=!0)},this);h=-1!==k.indexOf(this.hiddenFields,a.name)||"esriFieldTypeOID"===a.type||"esriFieldTypeGlobalID"===
a.type||q&&!1===q.visible||"*"!==this.outFields[0]&&-1===k.indexOf(this.outFields,a.name);this.layerInfo.fieldInfos[c]=d.clone({idx:c,name:a.name,alias:e,length:a.length||null,type:a.type,hidden:h,editable:this.editable&&a.name!==this.idProperty&&this.layerInfo.editable&&this.layerInfo.editCapabilities.canUpdate?n&&"undefined"!==typeof n.editable?q&&"undefined"!==typeof q.editable&&!1!==n.editable?q.editable||!1:n.editable:!1:!1,nullable:n.nullable||!1,domain:f,typeId:g,subtypeDomain:x,format:q&&
q.format?q.format:null,dateOptions:q&&(q.dateOptions||q.format&&q.format.dateFormat)||null})},this),this.get("showRelatedRecords")&&k.some(this.featureLayer.relationships,function(a,c){if(c===this._numRelationshipColumns)return!0;var e="esriRelCardinalityOneToOne"===a.cardinality||"esriRelCardinalityOneToMany"===a.cardinality&&"esriRelRoleDestination"===a.role,d=this.visibleLayerIds?this.visibleLayerIds[this.visibleLayerIds.length-1]===a.relatedTableId:!1;(this.showCyclicalRelationships||!e||!d)&&
this.layerInfo.fieldInfos.push({alias:a.name,name:a.name,type:"ft_related-records",relatedIndex:c,relationship:a})},this),this.get("showAttachments")&&this.featureLayer.hasAttachments&&this.layerInfo.fieldInfos.push({alias:this._i18nStrings.photosAndFiles,name:"ft_attachments",type:"ft_attachments",editable:this.featureLayer.hasAttachments&&this.editable&&this.layerInfo.editable})},_generateColumnOrder:function(a){var b=[],c=this.outFields;"*"!==c[0]?(-1===k.indexOf(c,this.idProperty)&&b.push(this._findFirst(a,
"name",this.idProperty)),k.forEach(c,function(c){var d=this._findFirst(a,"name",c)||null;d&&(c.name!==this.idProperty&&-1===k.indexOf(b,d))&&b.push(d)},this),k.forEach(a,function(a){-1===k.indexOf(b,a)&&b.push(a)},this)):b=d.clone(a);return b},_generateColumnsFromFieldInfos:function(){var a=d.clone(this.layerInfo.fieldInfos)||[],b=[];k.forEach(a,function(a,e){"ft_attachments"===a.type?b.push(this._generateAttachmentsColumn(a)):"ft_related-records"===a.type?b.push(this._generateRelatedRecordsColumn(a)):
"esriFieldTypeDate"===a.type?a.editable?b.push(this._generateDateTimeEditorColumn(a)):b.push(this._generateDateTimeColumn(a)):a.domain?a.editable?b.push(this._generateDomainEditorColumn(a)):b.push(this._generateDomainColumn(a)):a.typeId?a.editable?b.push(this._generateTypeEditorColumn(a)):b.push(this._generateTypeColumn(a)):a.subtypeDomain?a.editable?b.push(this._generateSubtypeDomainEditorColumn(a)):b.push(this._generateSubtypeDomainColumn(a)):-1<k.indexOf(this._numericFieldTypes,a.type)?a.editable?
b.push(this._generateNumberEditorColumn(a)):b.push(this._generateNumberColumn(a)):-1===k.indexOf(this._unsupportedFieldTypes,a.type)&&(a.editable?b.push(this._generateStringEditorColumn(a)):b.push(this._generateStringColumn(a)))},this);this.set("columns",b);this.layerInfo.fieldInfos=d.clone(a)},_generateRelatedRecordsColumn:function(a){return{label:a.alias,field:a.name,type:"ft_related-records",get:d.hitch(this,function(b){return(b=this._getRelatedRecordsByIds(b[this.idProperty],a.relationship.id))&&
b.features?b.features.length:0}),renderCell:d.hitch(this,function(b,c,e,d){d=this._getRelatedRecordsByIds(b[this.idProperty],a.relationship.id);this._generateRelatedRecordsCell(b,c,e,this.grid,this.layerInfo,a,d&&d.features?d.features:d)}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a,this.css.relatedRecordsTitle)})}},_generateAttachmentsColumn:function(a){return{label:a.alias,field:a.name,type:"ft_attachments",get:d.hitch(this,function(a){return(a=this._attachmentInfos[a[this.idProperty]])&&
a.attachments?a.attachments.length:this.layerInfo&&!1===this.layerInfo.queryAttachmentsSupported?null:0}),renderCell:d.hitch(this,function(a,c,e,d){this._generateAttachmentsCell(a,c,e)}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a,this.css.attachmentsTitle)})}},_getDomainValueFromRow:function(a,b){if("range"===a.domain.type)return b[a.name];var c=this._findFirst(a.domain.codedValues,"code",b[a.name]);return c?c.name:""},_generateDomainColumn:function(a){return{label:a.alias,
field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){return this._getDomainValueFromRow(a,b)}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateDomainEditorColumn:function(a,b){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(c){return this._getDomainValueFromRow(a,c)}),renderCell:d.hitch(this,function(c,b,g){var f=l.create("div",{innerHTML:b},g),h=[];f.innerHTML=b;if(a.domain.codedValues)k.forEach(a.domain.codedValues,
function(b){c[a.name]===b.code?h.push({label:b.name,value:b.code,selected:!0}):h.push({label:b.name,value:b.code})}),this._isValueEmpty(c[a.name])&&a.nullable?h.push({label:this._i18nStrings.empty,value:"ft_null",selected:!0}):this._isValueEmpty(c[a.name])&&!a.nullable?h.push({label:this._i18nStrings.empty,value:"ft_null",selected:!0,disabled:!0}):a.nullable&&h.push({label:this._i18nStrings.empty,value:"ft_null"}),m(g,this.editOn,d.hitch(this,function(){this._closeEditors();f.innerHTML="";var b=new H({options:h,
style:{width:"100%"}});b.placeAt(f);this.emit("editor-show",{cell:g,editor:b,grid:this.grid});m(b,"blur",d.hitch(this,function(){var b=this._findFirst(a.domain.codedValues,"code",c[a.name]);f.innerHTML=b?b.name:""}));m(b,"keydown",function(a){13===a.keyCode&&b.focusNode.blur()});m(b,"change",d.hitch(this,function(e){var d={fieldName:a.name,oldValue:c[a.name],rowId:c[this.idProperty],rowObject:c};"ft_null"===e&&(e=null);c[a.name]=e;e=this._findFirst(a.domain.codedValues,"code",e);f.innerHTML=e?e.name:
"";b.destroy();this._applyEditsByRow(c,d);this.emit("editor-hide",{cell:g,editor:b,grid:this.grid})}));this._activeEditors.push({id:c[this.idProperty],widget:b})}));else if("range"===a.domain.type){var x=a.domain.minValue,n=a.domain.maxValue;m(g,this.editOn,d.hitch(this,function(){this._closeEditors();f.innerHTML="";var b=new F({value:c[a.name],required:!a.nullable,constraints:{min:x,max:n}});b.placeAt(f);b.focus();b.textbox.select();this.emit("editor-show",{cell:g,editor:b,grid:this.grid});m(b,"blur",
d.hitch(this,function(){f.innerHTML=c[a.name]}));m(b,"keydown",function(a){13===a.keyCode&&b.isValid()&&b.focusNode.blur()});m(b,"change",d.hitch(this,function(e){var d={fieldName:a.name,oldValue:c[a.name],rowId:c[this.idProperty],rowObject:c};b.isValid()?(c[a.name]=e,f.innerHTML=e,b.destroy(),this._applyEditsByRow(c,d)):(f.innerHTML=c[a.name],b.destroy(),this.emit("editor-hide",{cell:g,editor:b,grid:this.grid}))}));this._activeEditors.push({id:c[this.idProperty],widget:b})}))}else this.emit("error",
{message:this._i18nStrings.errorDomainType})}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_getTypeValueFromRow:function(a,b){var c=this.layerInfo.types,e=c&&c[0],d,f;e&&(d=b[a.name],f=-1!==k.indexOf(this._numericFieldTypes,a.type),e=(e="string"===typeof e.id)&&f?d.toString():d,d=(d=this._findFirst(c,"id",e))?d.name:null);return d},_generateTypeColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){return this._getTypeValueFromRow(a,
b)}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateTypeEditorColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){return this._getTypeValueFromRow(a,b)}),renderCell:d.hitch(this,function(b,c,e){var g=l.create("div",{innerHTML:c},e),f=[];g.innerHTML=c;k.forEach(this.layerInfo.types,function(c){b[a.name]===c.id?f.push({label:c.name,value:c.id,selected:!0}):f.push({label:c.name,value:c.id})},this);
this._isValueEmpty(b[a.name])&&a.nullable?f.push({label:this._i18nStrings.empty,value:"ft_null",selected:!0}):this._isValueEmpty(b[a.name])&&!a.nullable?f.push({label:this._i18nStrings.empty,value:"ft_null",selected:!0,disabled:!0}):a.nullable&&f.push({label:this._i18nStrings.empty,value:"ft_null"});m(e,this.editOn,d.hitch(this,function(){this._closeEditors();g.innerHTML="";var c=new H({options:f,style:{width:"100%"}});c.placeAt(g);this.emit("editor-show",{cell:e,editor:c,grid:this.grid});m(c,"blur",
d.hitch(this,function(){var c=this._findFirst(this.layerInfo.types,"id",b[a.name]);g.innerHTML=c?c.name:null}));m(c,"keydown",function(a){13===a.keyCode&&c.focusNode.blur()});m(c,"change",d.hitch(this,function(d){var f={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};"ft_null"===d&&(d=null);b[a.name]=d;d=this._findFirst(this.layerInfo.types,"id",d);g.innerHTML=d?d.name:null;c.destroy();this._applyEditsByRow(b,f);this.emit("editor-hide",{cell:e,editor:c,grid:this.grid})}));
this._activeEditors.push({id:b[this.idProperty],widget:c})}))}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateSubtypeDomainColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){var c,e=this._findFirst(this.layerInfo.types,"id",b[this.layerInfo.typeIdField]);e&&(e.domains&&e.domains[a.name]&&e.domains[a.name].codedValues)&&(c=this._findFirst(e.domains[a.name].codedValues,"code",b[a.name]));return c?
c.name:b[a.name]}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}},_generateSubtypeDomainEditorColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,editOn:this.editOn,editor:"text",get:d.hitch(this,function(b){var e,d=this._findFirst(this.layerInfo.types,"id",b[this.layerInfo.typeIdField]);d&&(d.domains&&d.domains[a.name]&&d.domains[a.name].codedValues)&&(e=this._findFirst(d.domains[a.name].codedValues,"code",b[a.name]));return e?e.name:
b[a.name]}),renderCell:d.hitch(this,function(b,e,g){var f=l.create("div",{innerHTML:e},g),h=!1;f.innerHTML=e;m(g,this.editOn,d.hitch(this,function(){this._closeEditors();var e=this._findFirst(this.layerInfo.types,"id",b[this.layerInfo.typeIdField]),n,q,l=[];if(e.domains[a.name]){n=e.domains[a.name].codedValues;q=this._findFirst(n,"code",b[a.name]);k.forEach(n,function(e){b[a.name]===e.code?l.push({label:e.name,value:e.code,selected:!0}):l.push({label:e.name,value:e.code});e.code===q&&(h=!0)});this._isValueEmpty(b[a.name])&&
a.nullable?l.push({label:this._i18nStrings.empty,value:"ft_null",selected:!0}):this._isValueEmpty(b[a.name])&&!a.nullable?l.push({label:this._i18nStrings.empty,value:"ft_null",selected:!0,disabled:!0}):a.nullable&&l.push({label:this._i18nStrings.empty,value:"ft_null"});!h&&(!q&&null!==b[a.name])&&l.push({label:b[a.name],value:"N/A",selected:!0,disabled:!0});f.innerHTML="";var s=new H({options:l,style:{width:"100%"}});s.placeAt(f);this.emit("editor-show",{cell:g,editor:s,grid:this.grid});m(s,"blur",
d.hitch(this,function(){var e=this._findFirst(n,"code",b[a.name]);f.innerHTML=e?e.name:b[a.name]}));m(s,"keydown",function(a){13===a.keyCode&&s.focusNode.blur()});m(s,"change",d.hitch(this,function(e){var d={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};"ft_null"===e&&(e=null);b[a.name]=e;e=this._findFirst(n,"code",e);f.innerHTML=e?e.name:null;s.destroy();this._applyEditsByRow(b,d);this.emit("editor-hide",{cell:g,editor:s,grid:this.grid})}));this._activeEditors.push({id:b[this.idProperty],
widget:s})}else{f.innerHTML="";var r=new F({value:b[a.name],required:!a.nullable});r.placeAt(f);r.focus();r.textbox.select();this.emit("editor-show",{cell:g,editor:r,grid:this.grid});m(r,"blur",d.hitch(this,function(){f.innerHTML=b[a.name]}));m(r,"keydown",function(a){13===a.keyCode&&r.isValid()&&r.focusNode.blur()});m(r,"change",d.hitch(this,function(e){var d={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};r.isValid()?(b[a.name]=e,f.innerHTML=e,r.destroy(),this._applyEditsByRow(b,
d)):(f.innerHTML=b[a.name],r.destroy());this.emit("editor-hide",{cell:g,editor:r,grid:this.grid})}));this._activeEditors.push({id:b[this.idProperty],widget:r})}}));return e}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})};b.formatter=a.format&&a.format.embeddedHTML?d.hitch(this,function(a){return a||null}):a.format&&a.format.template?d.hitch(this,function(b){var e;b&&(e=p.substitute(a.format.template,{value:b}));return e||null}):a.format&&!1===a.format.link?d.hitch(this,
function(a){return a}):d.hitch(this,function(a){return this._generateLinkFromString(a)});return b},_generateStringColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})};b.formatter=a.format&&a.format.embeddedHTML?d.hitch(this,function(a){return a||null}):a.format&&a.format.template?d.hitch(this,function(b){var e;b&&(e=p.substitute(a.format.template,{value:b}));return e||null}):a.format&&!1===
a.format.link?d.hitch(this,function(a){return a}):d.hitch(this,function(a){return this._generateLinkFromString(a)});return b},_generateStringEditorColumn:function(a){var b=new I({label:a.alias,field:a.name,type:a.type,hidden:a.hidden,editorArgs:{required:!a.nullable},editOn:this.editOn,editor:"text",renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})});b.formatter=a.format&&a.format.embeddedHTML?d.hitch(this,function(a){return a||null}):a.format&&a.format.template?d.hitch(this,
function(b){var e;b&&(e=p.substitute(a.format.template,{value:b}));return e||null}):a.format&&!1===a.format.link?d.hitch(this,function(a){return a}):d.hitch(this,function(a){return this._generateLinkFromString(a)});return b},_getLocaleFormattedNumber:function(a){return isNaN(a)||null===a?null:ra.format(a)},_generateNumberColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){return this._getLocaleFormattedNumber(b[a.name])}),renderHeaderCell:d.hitch(this,
function(b){return this._getColumnHeaderCell(b,a)})};a.format&&a.format.template&&(b.formatter=d.hitch(this,function(b){var e;b&&(e=p.substitute(a.format.template,{value:b}));return e||null}));return b},_generateNumberEditorColumn:function(a){var b={label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){return this._getLocaleFormattedNumber(b[a.name])}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)}),renderCell:d.hitch(this,function(b,
e,g){var f=l.create("div",{innerHTML:e},g),h=null,k={};k.places="esriFieldTypeInteger"===a.type||"esriFieldTypeSmallInteger"===a.type?0:"0,20";h=a.format&&a.format.template&&null!==e?p.substitute(a.format.template,{value:e}):null===e?"":e;f.innerHTML=h;m(g,this.editOn,d.hitch(this,function(){this._closeEditors();f.innerHTML="";var e=new F({value:b[a.name],required:!a.nullable,constraints:k});e.placeAt(f);e.focus();e.textbox.select();this.emit("editor-show",{cell:g,editor:e,grid:this.grid});m(e,"blur",
d.hitch(this,function(){var e=b[a.name],d=null,d=a.format&&a.format.template&&null!==e?p.substitute(a.format.template,{value:this._getLocaleFormattedNumber(e)}):null===e?"":this._getLocaleFormattedNumber(e);f.innerHTML=d;g.focus()}));m(e,"keydown",function(a){13===a.keyCode&&e.isValid()&&e.focusNode.blur()});m(e,"change",d.hitch(this,function(d){var h={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b},k=null,k=null;if(""===d||isNaN(d))d=null;e.isValid()?(b[a.name]=d,null!==
d&&(k=this._getLocaleFormattedNumber(d)),k=a.format&&a.format.template&&null!==d?p.substitute(a.format.template,{value:k}):null===d?"":k,f.innerHTML=k,e.destroy(),this._applyEditsByRow(b,h)):(null!==b[a.name]&&(k=this._getLocaleFormattedNumber(b[a.name])),k=a.format&&a.format.template&&null!==b[a.name]?p.substitute(a.format.template,{value:k}):null===b[a.name]?"":k,f.innerHTML=k,e.destroy(),this.emit("editor-hide",{cell:g,editor:e,grid:this.grid}))}));this._activeEditors.push({id:b[this.idProperty],
widget:e})}))})};a.format&&a.format.template&&(b.formatter=d.hitch(this,function(b){var e;b&&(e=p.substitute(a.format.template,{value:b}));return e||null}));return b},_generateDateTimeColumn:function(a){var b={};return b=(a.dateOptions&&a.dateOptions.hasOwnProperty("timeEnabled"),{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){return""===b[a.name]||null===b[a.name]?null:this._generateDateFromLocale(new Date(b[a.name]),a)}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,
a)})})},_generateDateTimeEditorColumn:function(a){return(a.dateOptions&&a.dateOptions.hasOwnProperty("timeEnabled")?a.dateOptions.timeEnabled:this.dateOptions.timeEnabled)?{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:d.hitch(this,function(b){return""===b[a.name]||null===b[a.name]?null:this._generateDateFromLocale(new Date(b[a.name]),a)}),renderCell:d.hitch(this,function(b,c,e){var g,f;c&&l.create("div",{innerHTML:c},e);m(e,this.editOn,d.hitch(this,function(){this._closeEditors();g=
new O({value:new Date(b[a.name]),constraints:{datePattern:a.dateOptions&&a.dateOptions.datePattern?a.dateOptions.datePattern:this.dateOptions.datePattern}});g.on("change",d.hitch(this,function(c){if(g.isValid()){var e=f.getValue(),d={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};null===c||""===c?(f.setValue(null),b[a.name]=null):(null===e&&(e=new Date(0,0),f.setValue(e)),c=this._getCombinedDateTime(c,e).getTime(),b[a.name]=c);this._applyEditsByRow(b,d)}}));f=new ga({value:new Date(b[a.name]),
constraints:{timePattern:a.dateOptions&&a.dateOptions.timePattern?a.dateOptions.timePattern:this.dateOptions.timePattern}});f.on("change",d.hitch(this,function(c){if(f.isValid()){var e=g.getValue(),d={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b};null===c||""===c?(g.setValue(null),b[a.name]=null):(null===e&&(e=new Date(0,0),g.setValue(e)),c=this._getCombinedDateTime(e,c).getTime(),b[a.name]=c,this._applyEditsByRow(b,d))}}));e.innerHTML="";var c=l.create("div",{style:{"float":"left",
display:"inline"}},e);g.placeAt(c);f.placeAt(c);var m=ea.watch("activeStack",d.hitch(this,function(c,d,h){if((-1!==k.indexOf(d,g.id)||-1!==k.indexOf(d,f.id))&&-1===k.indexOf(h,g.id)&&-1===k.indexOf(h,f.id))m.remove(),d=g.getValue(),h=f.getValue(),c={fieldName:a.name,oldValue:b[a.name],rowId:b[this.idProperty],rowObject:b},f.isValid()&&g.isValid()?(d&&h?(d=this._getCombinedDateTime(d,h).getTime(),e.innerHTML=this._generateDateFromLocale(new Date(d),a)):(d=null,e.innerHTML=""),b[a.name]=d,this._applyEditsByRow(b,
c)):e.innerHTML=this._generateDateFromLocale(b[a.name],a)}));g.focus();g.textbox.select()}))}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})}:new I({label:a.alias,field:a.name,type:a.type,editorArgs:{required:!a.nullable,constraints:{datePattern:a.dateOptions&&a.dateOptions.datePattern?a.dateOptions.datePattern:this.dateOptions.datePattern}},editOn:this.editOn,hidden:a.hidden,formatter:d.hitch(this,function(b){return b?this._generateDateFromLocale(b,a):null}),get:d.hitch(this,
function(b){return""===b[a.name]||null===b[a.name]?null:new Date(b[a.name])}),renderHeaderCell:d.hitch(this,function(b){return this._getColumnHeaderCell(b,a)})},O)},_closeEditors:function(){k.forEach(this._activeEditors,function(a){a.widget.onBlur()});this.set("_activeEditors",[])},_getColumnHeaderCell:function(a,b,c){a=c?this.css.featureTableColumnHeaderTitle+" "+c:this.css.featureTableColumnHeaderTitle;c=l.create("div",{className:this.css.featureTableColumnHeader});!b.editable&&(this.editable&&
this.layerInfo.editable)&&l.create("span",{className:this.css.headerGear+" "+this.css.lockedIcon},c);l.create("div",{innerHTML:b.alias,className:a},c);l.create("div",{className:this.css.featureTableColumnHeaderClear},c);this.showColumnHeaderTooltips&&this.own(new da({connectId:[c],label:b.alias}));this.showDataTypes&&!("ft_related-records"===b.type||"ft_attachments"===b.type)&&l.create("div",{innerHTML:b.type.replace("esriFieldType",""),className:this.css.featureTableColumnHeaderType},c);return c},
_generateAttachmentsCell:function(a,b,c){if(this.layerInfo){var e=null!==b&&"undefined"!==typeof b?p.substitute(this._i18nStrings.parenValue,{value:b}):null,g=l.create("div",{innerHTML:e?e+" ":"",className:this.css.attachmentsCell},c),e=this.layerInfo,f=this._i18nStrings;l.create("span",{innerHTML:0<b||!e.queryAttachmentsSupported?f.show:e.editable?f.add:"",className:this.css.attachmentsLink},g);m(g,"click",d.hitch(this,function(e){if(0!==b||this.layerInfo.editCapabilities.canCreate)this.layerInfo.queryAttachmentsSupported?
this._showAttachmentsDialog(a,b,c,g):this._queryAttachmentInfos(a[this.idProperty]).then(d.hitch(this,function(b){this._attachmentInfos[a[this.idProperty]]={attachments:b};c.removeChild(c.firstChild);this._generateAttachmentsCell(a,b.length,c);this._showAttachmentsDialog(a,b.length,c,g)}))}))}},_generateRelatedRecordsCell:function(a,b,c,e,g,f,h){e=null!==b&&"undefined"!==typeof b?p.substitute(this._i18nStrings.parenValue,{value:b}):null;e=l.create("div",{innerHTML:e?e+" ":null,className:this.css.relatedRecordsCell},
c);l.create("span",{innerHTML:0<b?this._i18nStrings.show:"",className:this.css.relatedRecordsLink},e);0<b&&m(c,"click",d.hitch(this,function(b){b=this.grid.cell(b).column;this._showRelatedRecords(a,f,h,b)}))},_selectFeaturesFromIds:function(a){if(a||0!==this.selectedRowIds.length){var b=new t;b.returnGeometry=!!this.map;b.objectIds=a||this.selectedRowIds;this.layerInfo.isFeatureCollection||(b.where="1\x3d1");return this.featureLayer.selectFeatures(b,sa.SELECTION_NEW)}},_updateGridSelection:function(){var a=
this.grid.selection,b=new B,c=[],e=[],d,f;for(d in a)a.hasOwnProperty(d)&&(f=parseInt(d,10),e.push(f),c.push(this.grid.row(f).data));this.set({selectedRows:c,selectedRowIds:e,_featureSelectedCount:e.length});b.resolve();return b},_applyEdits:function(a,b){a=a||[];if(!(0>=a.length)){var c=[];k.forEach(a,function(a){a.layer&&c.push(a.layer.applyEdits(a.adds,a.updates,a.deletes))});0<c.length?z(c).then(function(){b&&b()}).otherwise(d.hitch(this,function(){this.emit("error",{message:this._i18nStrings.errorUpdateFailed});
this._toggleLoadingIndicator(!1)})):this._toggleLoadingIndicator(!1)}},_applyEditsByRow:function(a,b){b&&this._rollbackInfos.push({id:b.rowId,data:b});this.getFeatureDataById(a[this.idProperty]).then(d.hitch(this,function(b){this._toggleLoadingIndicator(!0);b=b.features[0];b.attributes=a;this._applyEdits([{layer:this.featureLayer,updates:[b]}],null)}))},_addGridApplyEditsListener:function(){return m(this.featureLayer,"edits-complete",d.hitch(this,function(a){this.emit("edits-complete",a);a=a.updates||
[];var b=this._rollbackInfos,c,e,d,f;a&&a.length&&k.forEach(a,function(a){c=this._findFirst(b,"id",a.objectId);e=c.data;a.success||(a.error?this.emit("error",{message:a.error}):this.emit("error",{message:this._i18nStrings.errorUpdateFailed}),e?(d=this.grid.row(e.rowId),f=d.data,f[this.idProperty]===a.objectId?(f[e.fieldName]=e.oldValue,this.grid.updateDirty(e.rowId,e.fieldName,e.oldValue),this.grid.refresh()):this.emit("error",{message:this._i18nStrings.errorRollback})):this.emit("error",{message:this._i18nStrings.errorRollback}));
this._rollbackInfos.splice(k.indexOf(this._rollbackInfos,c),1);this._toggleLoadingIndicator(!1)},this);this.layerInfo.isFeatureCollection&&this._generateStore();this._toggleLoadingIndicator(!1)}))},_addGridLayerClickCallback:function(){return m(this.featureLayer,"click",d.hitch(this,function(a){if(this.syncSelection&&a.graphic&&a.graphic.attributes&&a.graphic.attributes[this.idProperty]){this.grid.clearSelection();this.featureLayer.clearSelection();var b=a.graphic.attributes[this.idProperty];this._selectFeaturesFromIds([b]).then(d.hitch(this,
function(a){if(a.length){if(this.map&&this.zoomToSelection){var e=this._calcGraphicsExtent(a);e?(e=e.getCenter(),this.map.centerAt(e).then(function(){k.forEach(a,function(a){a.getDojoShape()&&a.getDojoShape().moveToFront()})})):this.emit("error",{message:this._i18nStrings.errorValidExtent})}var e=this.dataStore.get(b),g=k.indexOf(this.dataStore.data,e);("undefined"===typeof e||-1===g)&&this.emit("error",this._i18nStrings.errorLoadRow);this.grid.select(b);this._updateGridSelection().then(d.hitch(this,
function(){this._updateGridHeaderText();m.once(this.grid,"scroll",d.hitch(this,function(){this.grid.row(b).element&&this.grid.row(b).element.scrollIntoView()}));this.grid.scrollTo({x:0,y:this.grid.rowHeight*g})}))}}),d.hitch(this,function(){this.emit("error",{message:this._i18nStrings.errorSelectFeatures})}))}}))},_addGridRefreshListener:function(){return m(this.grid,"dgrid-refresh-complete",d.hitch(this,function(a){this.grid.columns[0]&&this.emit("refresh",a)}))},_addGridDataChangeListener:function(){return m(this.grid,
"dgrid-datachange",d.hitch(this,function(a){var b=a.cell.column.field,c=a.value,e=parseInt(a.rowId,10),g=this.grid.row(e).data,f=this._findFirst(this.layerInfo.fieldInfos,"name",b),h={oldValue:a.oldValue,fieldName:b,rowId:e,rowObject:g};this.emit("data-change",a);""===c&&(c=null);if(("esriFieldTypeInteger"===f.type||"esriFieldTypeSmallInteger"===f.type)&&null!==c)c=parseInt(c,10);if(("esriFieldTypeDouble"===f.type||"esriFieldTypeSingle"===f.type)&&null!==c)c=parseFloat(c);c&&c.getTime&&c.getTime()?
g[b]=c.getTime():g[b]=c;this._updateGridSelection().then(d.hitch(this,function(){this._updateGridHeaderText();this._applyEditsByRow(g,h)}))}))},_addGridSelectListener:function(){return m(this.grid,"dgrid-select",d.hitch(this,function(a){this._activeEditors[0]&&this._activeEditors[0].id&&a.rows[0]&&Number(a.rows[0].id)!==Number(this._activeEditors[0].id)&&this._closeEditors();this._updateGridSelection().then(d.hitch(this,function(){this.emit("row-select",a.rows);this._updateGridHeaderText();this.map&&
this.syncSelection&&this._selectFeaturesFromIds().then(d.hitch(this,function(a){if(this.zoomToSelection){var c=this._calcGraphicsExtent(a);c?(c=c.getCenter(),this.map.centerAt(c).then(function(){k.forEach(a,function(a){a.getDojoShape()&&a.getDojoShape().moveToFront()})})):this.emit("error",{message:this._i18nStrings.errorValidExtent})}}),d.hitch(this,function(){this.emit("error",{message:this._i18nStrings.errorSelectFeatures})}))}))}))},_addGridDeselectListener:function(){return m(this.grid,"dgrid-deselect",
d.hitch(this,function(a){this._updateGridSelection().then(d.hitch(this,function(){this.emit("row-deselect",a.rows);this._updateGridHeaderText();this._selectFeaturesFromIds()}))}))},_addGridColumnStateChangeListener:function(){return m(this.grid,"dgrid-columnstatechange",d.hitch(this,function(a){this.emit("column-state-change",a)}))},_addGridColumnResizeListener:function(){return m(this.grid,"dgrid-columnresize",d.hitch(this,function(a){this.emit("column-resize",a)}))},_addGridErrorListener:function(){return m(this.grid,
"dgrid-error",d.hitch(this,function(a){this.emit("error",a)}))},_addGridSortListener:function(){return m(this.grid,"dgrid-sort",d.hitch(this,function(a){this.emit("sort",a)}))},_addGridFilterListener:function(){return m(this.grid,"dgrid-filter",d.hitch(this,function(a){this.emit("filter",a)}))},_addGridEditorShowListener:function(){return m(this.grid,"dgrid-editor-show",d.hitch(this,function(a){this.emit("editor-show",a)}))},_addGridEditorHideListener:function(){return m(this.grid,"dgrid-editor-hide",
d.hitch(this,function(a){this.emit("editor-hide",a)}))},_addGridColumnClickCallback:function(){return this.grid.on(".dgrid-header .dgrid-cell:click",d.hitch(this,this._showColumnMenu))},_resize:function(){this._gridBorderContainer.resize();this._gridHeaderNode.resize();this._gridContentPane.resize();this.grid&&this.grid.resize()},_updateGridHeaderText:function(){this._gridTitleNode&&(this._gridTitleNode.innerHTML=this.showFeatureCount?p.substitute(this._i18nStrings.gridHeader,{gridTitle:this.featureLayer.name||
this._i18nStrings.untitled,featureCount:this.filterIds?this.filterIds.length:this.featureCount,featureSelectedCount:this._featureSelectedCount}):this.featureLayer.name||this._i18nStrings.untitled)},_toggleLoadingIndicator:function(a){this._gridLoadingIndicatorNode&&(this._gridLoadingIndicatorNode.style.display=a?"block":"none")},_showLoadError:function(){this._toggleLoadingIndicator(!1);this._gridTitleNode&&(this._gridTitleNode.innerHTML=this._i18nStrings.dataError)},_generateDialog:function(a){a=
new ca({title:a.title,content:a.content,baseClass:this.css.dialog});l.create("div",{className:"break"},a.containerNode);return a},_showAttachmentsDialog:function(a,b,c,e){var g=a[this.idProperty],f=this._attachmentInfos[g]?this._attachmentInfos[g].attachments:[];e=l.create("div",{});var h,k,n,q;h=this._tabContainer=new wa({"class":this.css.attachmentsTabContainer},l.create("div",null,e));k=this._viewPane=new Q({title:this._i18nStrings.view,content:this._generateViewAttachmentContent(a,c,g,f),"class":this.css.attachementsViewPane,
selected:0<b?!0:!1,disabled:0<b?!1:!0});n=this._addPane=new Q({title:this._i18nStrings.add,content:this._generateAddAttachmentContent(),"class":this.css.attachementsAddPane,selected:0===b?!0:!1,disabled:!(this.layerInfo.editable&&this.editable)});h.addChild(k);h.addChild(n);h.startup();f=l.create("button",{type:"button"},e);this._closeButton=new G({label:this._i18nStrings.close,baseClass:"esri-attachments-dialog-button primary cancel dijitButton",onClick:d.hitch(this,function(){this._attachmentsDialog.hide()})},
f);f=l.create("button",{type:"button"},e);this._addButton=new G({label:this._i18nStrings.upload,baseClass:"esri-attachments-dialog-button primary dijitButton",style:0<b?"display:none;":"",disabled:!0,onClick:d.hitch(this,function(){if(this._addAttachmentInput.files&&this._addAttachmentInput.files[0]){var b=this._addAttachmentInput.files[0];q.innerHTML=this._i18nStrings.uploading;this._closeButton.setDisabled(!0);this._addButton.setDisabled(!0);var e=new FormData;e.append("attachment",b,b.name);this.featureLayer.addAttachment(g,
e).then(d.hitch(this,function(b){b.success?(this._closeButton.setDisabled(!1),this._addAttachmentInput.value="",!0===k.disabled&&k.set("disabled",!1),q.innerHTML=this._i18nStrings.uploadSuccess,this._queryAttachmentInfos(g).then(d.hitch(this,function(b){k.setContent(this._generateViewAttachmentContent(a,c,g,b));this._attachmentInfos[g]={attachments:b};c.removeChild(c.firstChild);this._generateAttachmentsCell(a,b.length,c)}))):(this._addAttachmentInput.value="",q.innerHTML=this._i18nStrings.uploadFail,
this._closeButton.setDisabled(!1))})).otherwise(d.hitch(this,function(){this._addAttachmentInput.value="";q.innerHTML=this._i18nStrings.uploadFail;this._closeButton.setDisabled(!1)}))}})},f);h.watch("selectedChildWidget",d.hitch(this,function(a,b,c){this._attachmentFeedbackNode.innerHTML="";D.set(this._addButton.domNode,"display",c==n?"inline-block":"none")}));q=this._attachmentFeedbackNode=l.create("div",{innerHTML:"","class":this.css.attachmentsFeedbackText},e);this._attachmentsDialog=this._generateDialog({title:this._i18nStrings.photosAndFiles,
content:e});m(this._attachmentsDialog,"hide",d.hitch(this,function(a){this._attachmentsDialog.destroyRecursive();this._attachmentsDialog=null}));this._attachmentsDialog.show()},_generateViewAttachmentContent:function(a,b,c,e){var g={},f=this.featureLayer._url.path+"/"+c+"/attachments/",h=l.create("div",{"class":this.css.attachementsViewPaneContent}),x=T.objectToQuery({gdbVersion:this.featureLayer.gdbVersion,token:this.featureLayer._getToken()}),n=x?"?"+x:"";k.forEach(e,function(k,x){var s=k.id,r=
k.name,p=this._toAttachmentTypeIconClass(r,k.contentType),u=k.size,v=f+s+n,t,w;t=l.create("div",{"class":this.css.attachmentsNode},h);g[s]=t;l.create("div",{"class":this.css.attachmentsNodeIcon+" "+p},t);p=l.create("div",{"class":this.css.attachmentsNodeTextContainer},t);w=l.create("span",{"class":this.css.attachmentsNodeTextName},p);l.create("a",{href:v,title:r,innerHTML:r,target:"_blank"},w);l.create("span",{"class":this.css.attachmentsNodeTextSize,innerHTML:this._parseAttachmentSize(u)},p);r=l.create("div",
{"class":this.css.attachmentsNodeDelete},t);this.layerInfo.editable&&(l.create("span",{"class":"icon-ui-close-circled"},r),m(r,"click",d.hitch(this,function(f){D.set(this._attachmentFeedbackNode,"display","inline");this._attachmentFeedbackNode.innerHTML=this._i18nStrings.deleting;this.featureLayer.deleteAttachments(c,[s]).then(d.hitch(this,function(c){c[0]&&c[0].success?(c=g[s],c.parentNode.removeChild(c),e.splice(x,1),0===e.length&&(this._viewPane.set("disabled",!0),this._addPane.set("selected",
!0),this._tabContainer.selectChild(this._addPane)),this._attachmentFeedbackNode.innerHTML=this._i18nStrings.deleteSuccess,b.removeChild(b.firstChild),this._generateAttachmentsCell(a,e.length,b)):this._attachmentFeedbackNode.innerHTML=this._i18nStrings.deleteFail}))})))},this);return h},_generateAddAttachmentContent:function(){var a=l.create("div",{"class":this.css.attachementsAddPaneContent}),b=this._addAttachmentInput=l.create("input",{type:"file",name:"ft_attachment_input",size:"40","class":"drag-drop"},
a);m(b,"change",d.hitch(this,function(a){this._attachmentFeedbackNode.innerHTML="";this._addButton.setDisabled(0<b.value.length?!1:!0)}));return a},_showRelatedRecords:function(a,b,c,e){var d=a[this.idProperty];b=b.relationship;var f=this.featureLayer.getField(b.keyField),f=f?f.name:null,h=this.columns,l=k.filter(h,function(a){return!a.hidden}),m=this._findFirst(l,"field",this.featureLayer.displayField),q=this._findFirst(l,"field",f),p=this._findFirst(l,"type","esriFieldTypeString"),s=this._findFirstNumberColumn(),
l=this._findFirst(l,"type","esriFieldTypeDate");e=this._validateRelatedColumnDisplay(m)?h.indexOf(m):this._validateRelatedColumnDisplay(q)?h.indexOf(q):this._validateRelatedColumnDisplay(p)?h.indexOf(p):this._validateRelatedColumnDisplay(s)?h.indexOf(s):this._validateRelatedColumnDisplay(l)?h.indexOf(l):h.indexOf(e);this.emit("show-related-records",{row:a,featureId:d,records:c,keyField:f,columnId:e,relationship:b})},_findFirstNumberColumn:function(){var a;k.some(this.columns,function(b,c){if(-1!==
k.indexOf(this._numericFieldTypes,b.type)&&b.field!==this.idProperty&&!b.hidden)return a=b,!0},this);return a},_validateRelatedColumnDisplay:function(a){return!(!a||a.hidden||-1===this.columns.indexOf(a)||"esriFieldTypeOID"===a.type||"esriFieldTypeGlobalID"===a.type)},_showStatisticsDialog:function(a,b){var c=a.features[0].attributes,e={pattern:"#,###,###,##0.########"},g={},f,h;this._statisticsDialog&&this._statisticsDialog.destroy();for(f in c)c.hasOwnProperty(f)&&(g[f.toLowerCase()]=c[f]);f=[{title:this._i18nStrings.numberOfValues,
value:v.isDefined(g.countfield)?u.format(g.countfield,e):""},{title:this._i18nStrings.sumOfValues,value:v.isDefined(g.sumfield)?u.format(g.sumfield,e):""},{title:this._i18nStrings.minimum,value:v.isDefined(g.minfield)?u.format(g.minfield,e):""},{title:this._i18nStrings.maximum,value:v.isDefined(g.maxfield)?u.format(g.maxfield,e):""},{title:this._i18nStrings.average,value:v.isDefined(g.avgfield)?u.format(u.round(g.avgfield,this._roundPos(g.avgfield)),e):""},{title:this._i18nStrings.standardDeviation,
value:v.isDefined(g.stddevfield)?u.format(u.round(g.stddevfield,this._roundPos(g.stddevfield)),e):""}];e=l.create("div",{className:"esriAGOTableStatistics"});l.create("div",{className:"header",innerHTML:p.substitute(this._i18nStrings.fieldLabel,{fieldName:b})},e);l.create("div",{className:"hzLine"},e);g=l.create("table",{className:"attrTable",style:{cellpadding:0,cellspacing:0}},e);h=l.create("tbody",{},g);k.forEach(f,function(a){var b=l.create("tr",{valign:"top"},h);l.create("td",{"class":"attrName",
innerHTML:a.title},b);l.create("td",{"class":"attrValue",innerHTML:a.value},b)});l.create("div",{className:"break"},e);g=l.create("button",{type:"button"},e);this._closeButton=new G({label:this._i18nStrings.close,baseClass:"btn primary dijitButton",onClick:d.hitch(this,function(){var a=this._statisticsDialog;a.hide().then(d.hitch(this,function(){a.destroyRecursive();this._closeButton=null}))})},g);this._statisticsDialog=this._generateDialog({title:this._i18nStrings.statistics,content:e});this._statisticsDialog.show();
this.emit("show-statistics",{dialog:this._statisticsDialog,statistics:c})},_getColumnStats:function(a){var b=this.columns[a].field;a=[];var c="countField sumField minField maxField avgField stddevField".split(" "),e;e=new t;e.outFields=[b];e.outStatistics=[];e.where="1\x3d1";k.forEach("count sum min max avg stddev".split(" "),function(a,d){var h=new ta;h.statisticType=a;h.onStatisticField=b;h.outStatisticFieldName=c[d];h.displayFieldName=b;e.outStatistics.push(h)},this);0<this._filteredRowIds.length&&
(a=this._filteredRowIds);e.where&&0<a.length&&(e.where="("+e.where+") AND ("+this.idProperty+" IN ("+a.toString()+"))");(new ua(this.featureLayer.url)).execute(e).then(d.hitch(this,function(a){a.features&&a.features.length&&this._showStatisticsDialog(a,b)}),function(){this.emit("error",{message:this._i18nStrings.errorSelectFeatures})})},_showColumnMenu:function(a){var b=this.grid.cell(a),c=b.column;if(c){var e=this.get("columnMenu"),g=e,f=c.id,c=this.columns[f],h=this._findFirst(this.layerInfo.fieldInfos,
"name",c.field),l=h.type,n,q;e&&this.set("columnMenu",null);var p=new N({});if(!1!==c.sortable&&!(this.dataStore instanceof w&&("ft_related-records"===c.type||"ft_attachments"===c.type))){if(this.featureCount<=this.featureLayer.maxRecordCount||this.featureLayer.advancedQueryCapabilities.supportsPagination)e=[this._i18nStrings.sortAsc,this._i18nStrings.sortDesc],n=["iconSortAscending","iconSortDescending"],q=[this._sortAscending,this._sortDescending],k.forEach(e,function(a,b){var c=new A({label:a,
iconClass:n[b],baseClass:this.css.menuItem,onClick:d.hitch(this,q[b],f)});p.addChild(c)},this);this.showStatistics&&(this.featureLayer.supportsStatistics&&h&&!h.domain)&&-1!==k.indexOf(this._numericFieldTypes,l)&&(e=new A({label:this._i18nStrings.statistics,iconClass:"iconTableStatistics",baseClass:this.css.menuItem,onClick:d.hitch(this,this._getColumnStats,f)}),p.addChild(e));if(this.showFieldDetails&&!("ft_related-records"===c.type||"ft_attachments"===c.type||"esriFieldTypeOID"===h.type||"esriFieldTypeGUID"===
h.type||"esriFieldTypeGlobalID"===h.type||-1!==k.indexOf(this._unsupportedFieldTypes,h.type)))c=new A({label:this._i18nStrings.showDetailedView,iconClass:"iconProperties",baseClass:this.css.menuItem,onClick:d.hitch(this,function(a){this.emit("show-detailed-field-view",{columnId:parseInt(f,10),fieldInfo:h})})}),p.addChild(c);p.startup();c=b.element.getBoundingClientRect();p._openMyself({target:a.target,delegatedTarget:b,iframe:null,coords:{x:c.right-c.width,y:c.top+c.height}});m(p,"close",d.hitch(this,
function(){g&&(g.destroyRecursive(),g=null)}));this.set("columnMenu",p)}}},_sortAscending:function(a){var b=this._findFirst(this.layerInfo.fieldInfos,"name",this.columns[a].field).type;this.dataStore instanceof w&&(this.set("_orderByFields",[this.columns[a].field+" ASC"]),this._generateStore());this.grid.set("sort",[{attribute:this.columns[a].field,descending:!1,columnId:a,fieldType:b}]);this.emit("sort",{field:this.columns[a].field,descending:!1,columnId:a})},_sortDescending:function(a){var b=this._findFirst(this.layerInfo.fieldInfos,
"name",this.columns[a].field).type;this.dataStore instanceof w&&(this.set("_orderByFields",[this.columns[a].field+" DESC"]),this._generateStore());this.grid.set("sort",[{attribute:this.columns[a].field,descending:!0,columnId:a,fieldType:b}]);this.emit("sort",{field:this.columns[a].field,descending:!0,columnId:a})},_generateTableMenu:function(){this.gridMenu=new N({className:this.css.optionsMenu});var a=[this._i18nStrings.defaultSort,this._i18nStrings.showSelected,this._i18nStrings.clearSelection],
b=[this._defaultSortOrder,this._showSelectedRecords,this._clearSelection];this.map&&this.syncSelection&&(a.push(this._i18nStrings.centerOnSelection),b.push(this._centerOnSelection));this.gridOptions.columnHider&&(a.push(this._i18nStrings.toggleColumns),b.push(this._showHideColumns));0<this.menuFunctions.length&&k.forEach(this.menuFunctions,function(c){a.push(c.label);b.push(c.callback)},this);k.forEach(a,function(a,e){var g=new A({label:a,baseClass:this.css.menuItem,onClick:d.hitch(this,b[e])});this.gridMenu.addChild(g)},
this);this.gridMenuAnchor=new fa({label:E.widgets.geocodeMatch.match.tableOptionsLabel,dropDown:this.gridMenu},this._gridMenuNode);this.gridMenu.startup()},_defaultSortOrder:function(){this.dataStore instanceof w&&(this.set("_orderByFields",null),this._generateStore());this.grid.set("sort",[{attribute:this._defaultSortField,descending:!1}]);this.emit("sort",{field:this._defaultSortField,descending:!1})},_filterRecordsByIds:function(a){if(a&&0<a.length){this.set({_filteredRowIds:a,_gridQuery:!0});
if(this.dataStore instanceof w){var b=this._generateCacheStore(a);this.grid.set("store",b);this.set("dataStore",b)}else this.grid.set("query",d.hitch(this,function(b){return-1!==k.indexOf(a,b[this.idProperty])?!0:!1}));this.emit("filter",a)}},_showSelectedRecords:function(){this._filterRecordsByIds(this.selectedRowIds)},_centerOnSelection:function(){var a=this.selectedRowIds,b=new t;b.objectIds=a;b.outFields=["*"];0<this.selectedRows.length&&0<this.selectedRowIds.length&&this.featureLayer.queryFeatures(b,
d.hitch(this,function(a){this.map.setExtent(this._calcGraphicsExtent(a.features))}))},_clearSelection:function(){this.set("_filteredRowIds",[]);this._gridQuery&&(this.grid.set("query",{}),this.set("_gridQuery",!1));this.grid.clearSelection();this._updateGridSelection().then(d.hitch(this,function(){this._updateGridHeaderText();this.featureLayer.clearSelection()}));this.emit("filter",{})},_showHideColumns:function(){this.grid._toggleColumnHiderMenu()},_roundPos:function(a){return 1E3<=a?0:10<=a?2:0<=
a?4:6},_generateLinkFromString:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var c=a.indexOf(" ",b);-1===c&&(c=a.length);var e=a.substring(b,c);a=a.substring(0,b)+"\x3ca href\x3d'"+e+"' target\x3d'_blank'\x3e"+e+"\x3c/a\x3e"+a.substring(c,a.length)}}return a||""},_calcGraphicsExtent:function(a){var b=a[0].geometry,c,e,d;if(null===b&&1===a.length)return null;for(c=a.length-1;0<=c;c--)null===a[c].geometry&&a.splice(c,
1);b=a[0].geometry;c=b.getExtent();d=a.length;null===c&&(c=new P(b.x,b.y,b.x,b.y,b.spatialReference));for(var f=1;f<d;f++)b=a[f].geometry,e=b.getExtent(),null===e&&(e=new P(b.x,b.y,b.x,b.y,b.spatialReference)),c=c.union(e);return c},_generateDateFromLocale:function(a,b){var c=this.dateOptions,e=b&&b.dateOptions?b.dateOptions:!1,d=!1,f=!1,h={};e?("undefined"!==typeof e.datePattern&&!1!==e.datePattern?(h.datePattern=e.datePattern||c.datePattern,d=!0):c&&null!==c.datePattern&&(h.datePattern=c.datePattern,
d=!1===e.datePattern?!1:!0),e.timeEnabled||c.timeEnabled?(h.timePattern=e.timePattern||c.timePattern,f="undefined"!==typeof e.timeEnabled?e.timeEnabled:c.timeEnabled):c&&("undefined"!==typeof c.timeEnabled&&null!==c.timePattern)&&(h.timePattern=c.timePattern,f=c.timeEnabled)):(c&&null!==c.datePattern&&(h.datePattern=c.datePattern,d=!0),c&&("undefined"!==typeof c.timeEnabled&&null!==c.timePattern)&&(h.timePattern=c.timePattern,f=c.timeEnabled));d&&f?h.selector="date and time":d&&!f?h.selector="date":
!d&&f?h.selector="time":h.selecter="date";return S.format(new Date(a),h)},_getCombinedDateTime:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),b.getHours(),b.getMinutes(),b.getSeconds())},_toAttachmentTypeIconClass:function(a,b){var c=-1,d=a.substr(a.lastIndexOf(".")+1),g=["archive","audioVideo","document","image","other"],f={archive:this.css.attachmentsNodeIconArchive,audioVideo:this.css.attachmentsNodeIconAudioVideo,document:this.css.attachmentsNodeIconDocument,image:this.css.attachmentsNodeIconImage,
other:this.css.attachmentsNodeIconOther};k.some(this._supportedAttachmentTypes,function(a,b){if(-1!==a.indexOf(d.toLowerCase()))return c=b,!0});return f[g[c]?g[c]:"other"]},_parseAttachmentSize:function(a){var b=this._i18nStrings,c=[b.kB,b.MB,b.GB,b.TB],d=-1;if(1E3>Math.abs(a))return p.substitute(b.B,{fileSize:a});do a/=1E3,++d;while(1E3<=Math.abs(a)&&d<c.length-1);return p.substitute(c[d],{fileSize:a.toFixed(1)})},_isValueEmpty:function(a){return null===a||" "===a||""===a||"undefined"===typeof a},
_findFirst:function(a,b,c){return k.filter(a,function(a){return a.hasOwnProperty(b)&&a[b]===c})[0]||null}});K("extend-esri")&&d.setObject("dijit.FeatureTable",C,pa);return C});